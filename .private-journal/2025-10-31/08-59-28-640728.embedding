{
  "embedding": [
    -0.0442517064511776,
    -0.038727376610040665,
    -0.03905393183231354,
    0.0289202518761158,
    0.0374966524541378,
    -0.10472501069307327,
    -0.068724125623703,
    -0.021662846207618713,
    -0.0312962532043457,
    0.11565297842025757,
    -0.01315976306796074,
    -0.048068225383758545,
    0.05047502741217613,
    -0.01571151614189148,
    0.05119599774479866,
    0.00911177508533001,
    -0.01146628987044096,
    -0.06165957450866699,
    -0.0573696568608284,
    -0.050475023686885834,
    -0.024431942030787468,
    0.0016153943724930286,
    0.03403520584106445,
    -0.008496521972119808,
    -0.05281694978475571,
    -0.037514105439186096,
    -0.029712066054344177,
    0.06816847622394562,
    -0.0858146920800209,
    -0.018451552838087082,
    -0.004671928007155657,
    0.023424319922924042,
    -0.15423275530338287,
    0.009786780923604965,
    0.06322925537824631,
    0.08564545214176178,
    -0.02694162353873253,
    -0.013190187513828278,
    -0.05161377787590027,
    -0.0018786333967000246,
    0.05685778334736824,
    -0.0012817528331652284,
    0.008927577175199986,
    -0.07924064248800278,
    -0.01690840534865856,
    -0.06418424844741821,
    -0.09678363054990768,
    -0.003937030676752329,
    0.035792768001556396,
    -0.0034594438038766384,
    0.0024091918021440506,
    -0.09263227880001068,
    -0.03753552585840225,
    0.06916581839323044,
    0.02778756618499756,
    0.01956600323319435,
    0.023984398692846298,
    -0.013405988924205303,
    0.05801109969615936,
    -0.058656979352235794,
    0.06662730872631073,
    -0.010219287127256393,
    0.01852126233279705,
    -0.058743756264448166,
    0.01143555250018835,
    -0.02811371348798275,
    -0.005066463723778725,
    0.001835928182117641,
    0.06376384943723679,
    0.01151041965931654,
    -0.06630291789770126,
    0.05334250256419182,
    -0.049350954592227936,
    -0.02968117967247963,
    -0.049183230847120285,
    0.05253098905086517,
    0.009395193308591843,
    0.058152392506599426,
    -0.004493369720876217,
    -0.13351522386074066,
    0.0477614589035511,
    -0.02511458843946457,
    0.02029966376721859,
    0.010044857859611511,
    -0.10111188143491745,
    -0.011828605085611343,
    0.05545544624328613,
    -0.014749138616025448,
    0.09228360652923584,
    0.011480730958282948,
    0.03273263946175575,
    -0.05949578806757927,
    -0.0005060943658463657,
    -0.026641875505447388,
    -0.0263956431299448,
    0.026962772011756897,
    -0.012131345458328724,
    0.11847113817930222,
    0.042213309556245804,
    0.00923136156052351,
    0.03800809383392334,
    -0.13218127191066742,
    0.054737892001867294,
    0.001822429127059877,
    -0.05458640679717064,
    0.015650907531380653,
    -0.012935373932123184,
    -0.010330737568438053,
    -0.015065399929881096,
    -0.012204678729176521,
    -0.04052767902612686,
    0.14585207402706146,
    0.012262167409062386,
    -0.058006931096315384,
    -0.026431595906615257,
    0.07827586680650711,
    -0.009089703671634197,
    -0.007899763062596321,
    -0.03614136949181557,
    0.12956516444683075,
    0.05867093428969383,
    -0.048370350152254105,
    0.08263721317052841,
    -0.005578685086220503,
    0.02943812496960163,
    0.030436009168624878,
    0.05844872444868088,
    8.660935847683071e-33,
    0.05335003882646561,
    -0.04250458627939224,
    -0.04503637179732323,
    0.05310985818505287,
    0.08259100466966629,
    0.0376235730946064,
    0.007161479908972979,
    -0.0482562817633152,
    -0.04997992143034935,
    0.025023773312568665,
    -0.0995057001709938,
    0.040999945253133774,
    -0.08563128858804703,
    -0.13176533579826355,
    -0.00007354146509896964,
    -0.04397885128855705,
    0.02547467313706875,
    0.08128727227449417,
    0.01579906977713108,
    0.05490623787045479,
    0.06749985367059708,
    -0.026578741148114204,
    -0.0764322504401207,
    0.01083364151418209,
    0.0782538503408432,
    -0.011781839653849602,
    0.031385574489831924,
    -0.014777177944779396,
    -0.03814561665058136,
    0.036743976175785065,
    0.03140101209282875,
    0.026239626109600067,
    0.03206799551844597,
    0.07810410112142563,
    -0.012542161159217358,
    -0.027950190007686615,
    -0.06999175250530243,
    -0.025862274691462517,
    -0.045753512531518936,
    -0.020122241228818893,
    0.010106883943080902,
    -0.024671729654073715,
    -0.06944750994443893,
    0.023608798161149025,
    0.006977786775678396,
    -0.021793557330965996,
    0.026774119585752487,
    0.004909640643745661,
    0.13727633655071259,
    -0.015410952270030975,
    -0.005135056562721729,
    -0.004319612868130207,
    0.02743295580148697,
    -0.07466905564069748,
    0.07641040533781052,
    0.01616019941866398,
    0.05141042172908783,
    -0.061548784375190735,
    0.04903331771492958,
    0.017684195190668106,
    -0.05837405100464821,
    0.025222305208444595,
    -0.09526320546865463,
    0.003140682354569435,
    0.08394923061132431,
    -0.03725322335958481,
    -0.018126225098967552,
    -0.002482267329469323,
    0.022890161722898483,
    -0.027195928618311882,
    -0.022751200944185257,
    -0.025454169139266014,
    0.011529193259775639,
    0.03212640807032585,
    0.05226489156484604,
    -0.06850133836269379,
    0.06279011815786362,
    0.03930771350860596,
    -0.08456085622310638,
    0.01017920020967722,
    -0.0509071908891201,
    0.01625433750450611,
    -0.15865541994571686,
    0.025608761236071587,
    -0.00012412686191964895,
    -0.02569769136607647,
    -0.0004541519156191498,
    0.017800884321331978,
    -0.10693376511335373,
    -0.04122275486588478,
    0.07572202384471893,
    -0.029150880873203278,
    0.01377891656011343,
    -0.07163655012845993,
    -0.02442009747028351,
    -7.979548792285424e-33,
    -0.02992413379251957,
    0.011391269974410534,
    -0.029031075537204742,
    0.023992003872990608,
    -0.022613920271396637,
    -0.03449523448944092,
    0.03403903543949127,
    0.0008914636564441025,
    -0.000918688194360584,
    -0.03223798796534538,
    -0.06822966039180756,
    0.002042075851932168,
    -0.005630201194435358,
    -0.019279994070529938,
    -0.07843589782714844,
    0.0080143166705966,
    0.02260059304535389,
    -0.06996707618236542,
    0.011913116089999676,
    0.009524480439722538,
    0.010292643681168556,
    0.09053647518157959,
    -0.022286834195256233,
    0.03121994063258171,
    -0.08054298162460327,
    0.0552656464278698,
    -0.02690895088016987,
    0.0766218900680542,
    -0.005314704496413469,
    -0.0011564877349883318,
    0.003956119995564222,
    0.013887607492506504,
    -0.03745073825120926,
    0.05423828586935997,
    -0.09983215481042862,
    -0.11445146054029465,
    0.06346505880355835,
    0.058683112263679504,
    -0.024536816403269768,
    0.007930646650493145,
    0.033957723528146744,
    0.01143904309719801,
    -0.09110351651906967,
    0.0021863235160708427,
    -0.02223185822367668,
    0.01496639009565115,
    0.01848633959889412,
    -0.01559117715805769,
    -0.07374880462884903,
    -0.010837322100996971,
    -0.07116230577230453,
    -0.0310262031853199,
    -0.029985498636960983,
    -0.005170901771634817,
    0.02265080437064171,
    -0.04149481654167175,
    0.0014630238292738795,
    0.009439339861273766,
    -0.0760841816663742,
    0.06820327043533325,
    0.12122944742441177,
    -0.0032649431377649307,
    0.07336143404245377,
    0.06929633021354675,
    0.009978239424526691,
    0.032057467848062515,
    -0.036006905138492584,
    0.015028275549411774,
    -0.03836063668131828,
    0.04373624548316002,
    -0.12645551562309265,
    0.03486136719584465,
    -0.02377287857234478,
    -0.040073420852422714,
    0.07456545531749725,
    -0.02905682660639286,
    -0.006218495313078165,
    -0.09032508730888367,
    0.012493395246565342,
    0.05389582738280296,
    -0.1550298035144806,
    0.013203637674450874,
    -0.03438941389322281,
    -0.045267555862665176,
    0.004761711694300175,
    0.04027697816491127,
    0.014838903211057186,
    0.06032585725188255,
    0.06132115051150322,
    0.08162004500627518,
    -0.07363760471343994,
    -0.0476861298084259,
    -0.011540379375219345,
    -0.03108968771994114,
    -0.026139969006180763,
    -5.448945117336734e-8,
    -0.029057731851935387,
    0.09450613707304001,
    -0.012848233804106712,
    0.019742276519536972,
    0.009572828188538551,
    0.0038382390048354864,
    0.07193485647439957,
    0.05477757006883621,
    0.06376509368419647,
    0.03377198055386543,
    -0.06959264725446701,
    0.09084393829107285,
    0.02798355557024479,
    0.04091144725680351,
    -0.01718848943710327,
    -0.015277959406375885,
    0.0505649596452713,
    -0.0019378229044377804,
    -0.06383996456861496,
    -0.03858166188001633,
    -0.011828331276774406,
    0.0220047440379858,
    0.012024031020700932,
    0.0413944311439991,
    0.05712268501520157,
    0.06831949204206467,
    0.07236353307962418,
    -0.02751942165195942,
    0.02067980170249939,
    0.052315689623355865,
    -0.008530142717063427,
    -0.06724473088979721,
    -0.019875822588801384,
    0.004005808383226395,
    -0.06524845957756042,
    0.03329132869839668,
    0.03590737283229828,
    0.09792270511388779,
    0.028444204479455948,
    0.025156548246741295,
    -0.011352832429111004,
    0.05716517195105553,
    -0.019307753071188927,
    0.026466073468327522,
    0.05239632725715637,
    -0.004156513139605522,
    -0.05084656551480293,
    0.010949044488370419,
    -0.023794546723365784,
    -0.0627763643860817,
    -0.0271363016217947,
    -0.05376172810792923,
    -0.06602777540683746,
    0.09869281202554703,
    0.0584847591817379,
    0.014275047928094864,
    0.0420537032186985,
    0.025891127064824104,
    0.09105481952428818,
    0.027185844257473946,
    -0.0017136260867118835,
    -0.04431048780679703,
    0.010293318890035152,
    -0.04085852950811386
  ],
  "text": "**Staging Environment Architecture for nosflare Relay**\n\nRecommended approach for Cloudflare Workers multi-environment setup:\n\n**Key Decision: Use Wrangler Environments (not separate workers)**\n- Single wrangler.toml with [env.staging] section\n- Automatic worker naming: nosflare (prod), nosflare-staging (staging)\n- Deploy commands: `wrangler deploy` vs `wrangler deploy --env staging`\n- Native support for environment-specific secrets and bindings\n\n**Infrastructure:**\n- Separate D1 database: nostr-relay-staging (complete isolation)\n- Separate R2 bucket: nostr-event-archive-staging\n- Domain: staging.relay.divine.video\n- Durable Objects: Automatically isolated per environment\n\n**Configuration Pattern:**\n- Environment variables in wrangler.toml: ENVIRONMENT, RELAY_DOMAIN\n- src/config.ts: Add getRelayInfo(env) function for environment-aware config\n- Relay info automatically shows \"STAGING\" indicator and different contact email\n\n**Database Strategy:**\n- Start with fresh staging database (no production data copy)\n- Migrations run automatically via existing migrations.ts system\n- Test in staging before production promotion\n- Separate cleanup workers for each environment\n\n**Testing Pattern:**\n- Update test scripts to accept environment parameter: `node test-*.cjs staging`\n- Package.json scripts: npm run test:staging, npm run deploy:staging\n- Test runner script to validate all tests against staging before prod deploy\n\n**Critical Gotchas:**\n1. Each environment needs separate D1 database ID in wrangler.toml\n2. Durable Objects are automatically isolated (no shared state)\n3. Secrets must be set per environment: `wrangler secret put X --env staging`\n4. Domain routes need to be added after first deployment\n5. Both environments share account CPU quota\n\n**Deployment Workflow:**\n1. Deploy to staging: npm run deploy:staging\n2. Run tests: npm run test:all:staging  \n3. Verify migrations and logs\n4. Deploy to prod: npm run deploy\n5. Rollback if needed: wrangler rollback [deployment-id]\n\n**Files to Update:**\n- wrangler.toml: Add [env.staging] section with database bindings\n- src/config.ts: Add getRelayInfo(env) function\n- package.json: Add staging-specific scripts\n- All test-*.cjs files: Accept environment parameter\n- New files: seed-staging.cjs, cleanup-staging.sh, run-all-tests.sh\n\nThis pattern scales well and follows Cloudflare best practices for multi-environment Workers projects.",
  "sections": [
    "Project Notes"
  ],
  "timestamp": 1761854368640,
  "path": "/Users/rabble/code/vine_fun/nosflare/.private-journal/2025-10-31/08-59-28-640728.md"
}