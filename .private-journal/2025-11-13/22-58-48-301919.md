---
title: "10:58:48 PM - November 13, 2025"
date: 2025-11-13T22:58:48.301Z
timestamp: 1763074728301
---

## Project Notes

nosflare discovery query fix:

**Problem**: "New Videos" showing 2016 archived Vine content instead of recently added content. Root cause: 8000 users/hour mostly engaging (not posting videos), so newest `created_at` timestamps were from 2016 archive.

**Solution**: Automatic detection of discovery queries + sort by ingestion time.

Discovery query = no authors, no ids, no since/until (just browsing)
→ Use `created_timestamp DESC` (when relay received it)

Targeted query = has authors/ids/time filters (looking for something specific)
→ Use `created_at DESC` (original event timestamp)

**Changes**:
- Added `isDiscoveryQuery()` helper function
- Modified 2 ORDER BY clauses in buildQuery
- Migration 9: indexes on created_timestamp
- Updated index selection logic for discovery queries

**Files modified**:
- src/relay-worker.ts (query logic)
- src/migrations.ts (new indexes)

**Result**: "New Videos" now shows recently-ingested content (could be new user videos OR newly imported archive videos), while time-based searches still work for finding "videos from 2016".

Version deployed: 702ee0a8-50e9-4643-abe1-54eaee977c27

